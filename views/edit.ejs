<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Tiket - AGLIS Ticketing System</title>
    <link rel="stylesheet" href="/css/edit.css">
    <link rel="stylesheet" href="/css/adminlte.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body class="control-sidebar-slide-open sidebar-mini layout-fixed layout-navbar-fixed accent-info text-sm" style="height: auto;">
<div class="wrapper">
    <%- include('partials/header.ejs') %>
    <%- include('partials/sidebar.ejs') %>
    
    <!-- Content Wrapper -->
    <div class="content-wrapper">
        <section class="content">
            <div class="container-fluid">
                <h1>Edit Tiket</h1>
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">Informasi Laporan</h5>
                    </div>
                    <div class="card-body">
                        <form id="editTicketForm" method="POST" action="/ticket/update/<%= ticket.id %>">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title">Detail Laporan</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-3 form-group">
                                            <label for="no_tiket">Nomor Tiket</label>
                                            <input type="text" class="form-control" id="no_tiket" name="no_tiket" value="<%= ticket.no_tiket %>" readonly>
                                        </div>
                                        <div class="col-md-3 form-group">
                                            <label for="tanggal_laporan">Tanggal Laporan:</label>
                                            <input type="text" id="tanggal_laporan" name="tanggal_laporan" class="form-control" value="<%= formatDateTime(ticket.createdAt) %>" readonly>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-3 form-group">
                                            <label for="cid">CID:</label>
                                            <input type="text" id="cid" name="cid" class="form-control" required placeholder="Masukkan CID" value="<%= ticket.cid || '' %>" readonly>
                                        </div>
                                        <div class="col-md-3 form-group">
                                            <label for="nama">Nama:</label>
                                            <input type="text" id="nama" name="nama" class="form-control" required placeholder="Masukkan Nama" value="<%= ticket.nama || '' %>" readonly>
                                        </div>
                                        <div class="col-md-3 form-group">
                                            <label for="no_hp">No HP:</label>
                                            <input type="tel" id="no_hp" name="no_hp" class="form-control" required placeholder="Masukkan No HP" value="<%= ticket.no_hp %>" readonly>
                                        </div>
                                        <div class="col-md-3 form-group">
                                            <label for="pelapor">Pelapor:</label>
                                            <input type="text" id="pelapor" name="pelapor" class="form-control" required placeholder="Masukkan Pelapor" value="<%= ticket.pelapor || '' %>" readonly>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 form-group">
                                            <label for="alamat">Alamat:</label>
                                            <textarea type="text" id="alamat" name="alamat" class="form-control" required placeholder="Masukkan Alamat" readonly><%= ticket.alamat || '' %></textarea>
                                        </div>
                                        <div class="col-md-6 form-group">
                                            <label for="komplain">Komplain:</label>
                                            <textarea id="komplain" name="komplain" class="form-control" required placeholder="Masukkan Komplain" readonly><%= ticket.komplain || '' %></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title">Detail Perbaikan</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-3 form-group">
                                            <label for="jenis_gangguan">Jenis Gangguan:</label>
                                            <input type="text" id="jenis_gangguan" name="jenis_gangguan" class="form-control" placeholder="Masukkan Jenis Gangguan" value="<%= ticket.jenis_gangguan || '' %>" required>
                                        </div>
                                        <div class="col-md-3 form-group">
                                            <label for="jenis_perbaikan">Jenis Perbaikan:</label>
                                            <input type="text" id="jenis_perbaikan" name="jenis_perbaikan" class="form-control" placeholder="Masukkan Jenis Perbaikan" value="<%= ticket.jenis_perbaikan || '' %>" required>
                                        </div>
                                        <div class="col-md-3 form-group">
                                            <label for="lokasi_odp">Lokasi ODP:</label>
                                            <input type="text" id="lokasi_odp" name="lokasi_odp" class="form-control" placeholder="Masukkan Lokasi ODP" value="<%= ticket.lokasi_odp || '' %>">
                                        </div>
                                        <div class="col-md-3 form-group">
                                            <label for="lokasi_closure">Lokasi Closure:</label>
                                            <input type="text" id="lokasi_closure" name="lokasi_closure" class="form-control" placeholder="Masukkan Lokasi Closure" value="<%= ticket.lokasi_closure || '' %>">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-3 form-group">
                                            <label for="jarak_kabel">Jarak Kabel:</label>
                                            <input type="text" id="jarak_kabel" name="jarak_kabel" class="form-control" placeholder="Masukkan Jarak Kabel" value="<%= ticket.jarak_kabel || '' %>">
                                        </div>
                                        <div class="col-md-3 form-group">
                                            <label for="redaman_terakhir">Redaman Terakhir:</label>
                                            <input type="text" id="redaman_terakhir" name="redaman_terakhir" class="form-control" placeholder="Masukkan Redaman Terakhir" value="<%= ticket.redaman_terakhir || '' %>" required>
                                        </div>
                                        <div class="col-md-3 form-group">
                                            <label for="nama_wifi">Nama WiFi:</label>
                                            <input type="text" id="nama_wifi" name="nama_wifi" class="form-control" placeholder="Masukkan Nama WiFi" value="<%= ticket.nama_wifi || '' %>">
                                        </div>
                                        <div class="col-md-3 form-group">
                                            <label for="password_wifi">Password WiFi:</label>
                                            <input type="text" id="password_wifi" name="password_wifi" class="form-control" placeholder="Masukkan Password WiFi" value="<%= ticket.password_wifi || '' %>">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 form-group">
                                            <label for="keterangan">Keterangan:</label>
                                            <textarea id="keterangan" name="keterangan" class="form-control" placeholder="Masukkan Keterangan" required><%= ticket.keterangan || '' %></textarea>
                                        </div>
                                        <div class="col-md-3 form-group">
                                            <label for="teknisi">Teknisi:</label>
                                            <input type="text" id="teknisi" name="teknisi" class="form-control" placeholder="Masukkan Nama Teknisi" value="<%= ticket.teknisi || '' %>" required>
                                        </div>
                                        <div class="col-md-3 form-group">
                                            <label for="status">Status:</label>
                                            <select id="status" name="status" class="form-control" required>
                                                <option value="Terbuka" <%= ticket.status === 'Terbuka' ? 'selected' : '' %>>Terbuka</option>
                                                <option value="Selesai" <%= ticket.status === 'Selesai' ? 'selected' : '' %>>Selesai</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <button type="submit" class="btn btn-info btn-save">Perbarui Tiket</button>
                                <button type="button" class="btn btn-secondary btn-back" onclick="window.location.href='/list'">Batal</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <%- include('partials/footer.ejs') %>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
<script src="/js/adminlte.min.js"></script>
<script>
    
// Fungsi untuk memformat tanggal dan waktu
function formatDateTime(dateString) {
    const optionsDate = { year: 'numeric', month: 'long', day: 'numeric' };
    const optionsTime = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
    const date = new Date(dateString);
    const formattedDate = date.toLocaleDateString('id-ID', optionsDate); // Format tanggal dalam bahasa Indonesia
    const formattedTime = date.toLocaleTimeString('id-ID', optionsTime); // Format waktu dalam bahasa Indonesia
    return `${formattedDate} ${formattedTime}`; // Gabungkan tanggal dan waktu
}

const ticket = <%- JSON.stringify(ticket) %>; // Mengirim data tiket ke skrip
// console.log("Data Tiket:", ticket); // Memeriksa data tiket

// let formattedTanggalPerbaikan;
// if (ticket.status === 'Terbuka') {
//     formattedTanggalPerbaikan = null;
// } else if (ticket.tanggal_perbaikan) {
//     formattedTanggalPerbaikan = new Date(ticket.tanggal_perbaikan).toISOString().slice(0, 19).replace('T', ' ');
// } else {
//     console.error('Tanggal perbaikan tidak valid:', ticket.tanggal_perbaikan);
//     formattedTanggalPerbaikan = 'Tanggal perbaikan tidak tersedia'; // Atau nilai default lainnya
// }

// Panggil fungsi saat halaman dimuat untuk mengatur warna awal
$(document).ready(function() {
    $('#editTicketForm').on('submit', function(e) {
        // console.log('Formulir akan disubmit'); // Log saat formulir disubmit
        let isValid = true;

        // Validasi CID
        if ($('#cid').val().trim() === '') {
            isValid = false;
            alert('CID harus diisi.');
        }

        // Validasi Nama
        if ($('#nama').val().trim() === '') {
            isValid = false;
            alert('Nama harus diisi.');
        }

        // Validasi No HP
        if ($('#no_hp').val().trim() === '') {
            isValid = false;
            alert('No HP harus diisi.');
        }

        // Validasi Pelapor
        if ($('#pelapor').val().trim() === '') {
            isValid = false;
            alert('Pelapor harus diisi.');
        }

        // Validasi Alamat
        if ($('#alamat').val().trim() === '') {
            isValid = false;
            alert('Alamat harus diisi.');
        }
        
        // Validasi Komplain
        if ($('#komplain').val().trim() === '') {
            isValid = false;
            alert('Komplain harus diisi.');
        }
        
        // Jika tidak valid, hentikan pengiriman formulir
        if (!isValid) {
            e.preventDefault();
            console.log('Formulir tidak valid, pengiriman dihentikan.'); // Log jika formulir tidak valid
        } else {
            console.log('Formulir valid, melanjutkan pengiriman.'); // Log jika formulir valid
        }
    });
});
</script>
</body>
</html>